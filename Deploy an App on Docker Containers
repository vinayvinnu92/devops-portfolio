The Nautilus DevOps team is working to create new images per requirements shared by the development team. One of the team members is working to create a Dockerfile on App Server 1 in Stratos DC. While working on it she ran into issues in which the docker build is failing and displaying errors. Look into the issue and fix it to build an image as per details mentioned below:
a. The Dockerfile is placed on App Server 1 under /opt/docker directory.
b. Fix the issues with this file and make sure it is able to build the image.
c. Do not change base image, any other valid configuration within Dockerfile, or any of the data been used — for example, index.html.
Note: Please note that once you click on FINISH button all the existing containers will be destroyed and new image will be built from your Dockerfile.

                +---------------------+
                |     Host Server     |
                |   (App Server 2)   |
                |                     |
                |  Host Port 5004     |
                |       |             |
                |       v             |
                |   +---------------------+
                |   |   Docker Engine     |
                |   +---------------------+
                |          |
                |          v
                |   +---------------------+
                |   |  Container: nautilus-app  |
                |   |---------------------|
                |   |  Image: nautilus-app:latest |
                |   |  Apache httpd         |
                |   |  Listens on port 8080 |
                |   |  SSL: server.crt/key  |
                |   |  Website: index.html  |
                |   +---------------------+
                |                     |
                +---------------------+

#2️⃣ How to fix it properly

#You need to edit the Dockerfile as a text file, not run Dockerfile instructions in the shell.

Step 1: Edit the Dockerfile
cd /opt/docker
sudo vi Dockerfile


Replace the contents with this corrected Dockerfile:

FROM httpd:2.4.43

# Update Apache config using RUN and sed
RUN sed -i "s/Listen 80/Listen 8080/g" /usr/local/apache2/conf/httpd.conf && \
    sed -i '/LoadModule ssl_module modules\/mod_ssl.so/s/^#//g' /usr/local/apache2/conf/httpd.conf && \
    sed -i '/LoadModule socache_shmcb_module modules\/mod_socache_shmcb.so/s/^#//g' /usr/local/apache2/conf/httpd.conf && \
    sed -i '/Include conf\/extra\/httpd-ssl.conf/s/^#//g' /usr/local/apache2/conf/httpd.conf

# Copy SSL certificates
COPY certs/server.crt /usr/local/apache2/conf/server.crt
COPY certs/server.key /usr/local/apache2/conf/server.key

# Copy website content
COPY html/index.html /usr/local/apache2/htdocs/index.html

# Expose port 8080 (because we changed Listen)
EXPOSE 8080

# Run Apache in foreground
CMD ["httpd-foreground"]


#✅ Key fixes:

Use FROM instead of IMAGE.

Use RUN for commands, not ADD.

#Keep all COPY commands only for copying files.

Start Apache with CMD ["httpd-foreground"].

#Step 2: Save and exit

In vi: ESC → :wq → Enter

In nano: CTRL+O → CTRL+X

#Step 3: Build the Docker image
sudo docker build -t nautilus-app:latest .


#Expected output: You should see Docker steps executing successfully and a message like:

Successfully built <image-id>
Successfully tagged nautilus-app:latest

#Step 4: Run the container
sudo docker run -d -p 5004:8080 --name nautilus-app nautilus-app:latest


#Check status:

sudo docker ps


#Expected output:

CONTAINER ID   IMAGE                  COMMAND             STATUS          PORTS                    NAMES
<id>           nautilus-app:latest   "httpd-foreground"  Up X seconds    0.0.0.0:5004->8080/tcp   nau
